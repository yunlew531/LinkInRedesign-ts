var u=Object.defineProperty;var A=(o,t,e)=>t in o?u(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var m=(o,t,e)=>(A(o,typeof t!="symbol"?t+"":t,e),e);import{n as y,p as v,q as f,r as w,t as C,u as g,v as J,l as N}from"./index.9fe55531.js";import{r as O}from"./vendor.d65808b7.js";const{state:p}=N;class S{constructor(t){m(this,"apiMethod");m(this,"isCommentLimit",!1);m(this,"articles",O([]));this.apiMethod=t}async getArticles(t){try{const{data:e}=await this.apiMethod(t),{articles:s}=e;this.setArticles(s)}catch(e){console.dir(e)}}async thumbsUpArticle(t,e){const s=JSON.parse(JSON.stringify(t)),{id:i}=s,{name:a,photo:r,job:c}=p.value.user,d={name:a,photo:r,job:c};try{const{data:n}=await y(d,i),{likes:l}=n;s.likes=l,this.updateArticle(e,s)}catch(n){console.log(n)}}async removeThumbsUpArticle(t,e){const s=JSON.parse(JSON.stringify(t));try{const{data:i}=await v(t.id),{likes:a}=i;s.likes=a,this.updateArticle(e,s)}catch(i){console.log(i)}}async deleteArticle(t){try{await f(t),this.getArticles()}catch(e){console.dir(e)}}async postComment(t){const{articleId:e,articleIdx:s,comment:i}=t;if(this.isCommentLimit){alert("Please wait 30 seconds for each message");return}if(this.isCommentLimit=!0,!i){alert("comment required");return}const{name:a,photo:r}=p.value.user,c={name:a,photo:r||"",comment:i};return new Promise(async(d,n)=>{try{const{data:l}=await w(c,e),{comments:h}=l;this.updateComments(s,h),d()}catch(l){n(l)}setTimeout(()=>{this.isCommentLimit=!1},30*1e3)})}async deleteComment(t){const{article:e,articleIdx:s,commentId:i}=t,a=JSON.parse(JSON.stringify(e));try{const{data:r}=await C(e.id,i),{comments:c}=r;a.comments=c,this.updateComments(s,c)}catch(r){console.dir(r)}}async addArticleFavorite(t,e){const s=JSON.parse(JSON.stringify(t));try{const{data:i}=await g(t.id),{favorites:a}=i;s.favorites=a,this.setArticle(e,s),alert("add success")}catch(i){console.log(i)}}async removeArticleFavorite(t,e){const s=JSON.parse(JSON.stringify(t));return new Promise(async(i,a)=>{try{const{data:r}=await J(t.id),{favorites:c}=r;s.favorites=c,this.setArticle(e,s),alert("remove success"),i(c)}catch(r){a(r)}})}setArticle(t,e){this.articles.value[t]=e}setArticles(t){this.articles.value=t}updateArticle(t,e){this.articles.value[t]=e}updateComments(t,e){this.articles.value[t].comments=e}}var x=o=>new S(o);export{x as c};
