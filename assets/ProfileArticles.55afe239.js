import k from"./Article.e51e7827.js";import{e as O,n as S,o as T,p as U,q as g,r as D,t as N}from"./index.89e2cf0c.js";import{d as J,i as _,f as I,r as l,g as u,F as x,k as R,o as p,j as $}from"./vendor.a132856b.js";import"./main.21dd7f43.js";import"./dayjs.9461779c.js";const V=J({setup(q){const y=_(O),c=I(()=>y.value.user),r=l([]),d=async()=>{try{const{data:e}=await S();r.value=e.articles}catch(e){console.dir(e)}},v=(e,s)=>r.value[e]=s,A=async e=>{try{await T(e),d()}catch(s){console.dir(s)}},b=async(e,s)=>{const t=JSON.parse(JSON.stringify(e)),a={name:c.value.name,photo:c.value.photo,job:c.value.job};try{const{data:o}=await U(a,e.id),{likes:n}=o;t.likes=n,v(s,t)}catch(o){console.dir(o)}},C=async(e,s)=>{const t=JSON.parse(JSON.stringify(e));try{const{data:a}=await g(e.id),{likes:o}=a;t.likes=o,v(s,t)}catch(a){console.dir(a)}},f=(e,s)=>r.value[e].comments=s,h=l([]),m=l(!1),j=async e=>{const{articleId:s,articleIdx:t,comment:a}=e;if(m.value){alert("Please wait 30 seconds for each message");return}if(m.value=!0,!a){alert("comment required");return}const o={name:c.value.name,photo:c.value.photo||"",comment:a};try{const{data:n}=await D(o,s),{comments:i}=n;f(t,i),h.value[t].resetCommentInput(t)}catch(n){console.dir(n)}setTimeout(()=>{m.value=!1},30*1e3)},w=async e=>{const{article:s,articleIdx:t,commentId:a}=e,o=JSON.parse(JSON.stringify(s));try{const{data:n}=await N(s.id,a),{comments:i}=n;o.comments=i,f(t,i)}catch(n){console.dir(n)}};return(()=>{d()})(),(e,s)=>(p(),u("ul",null,[(p(!0),u(x,null,R(r.value,(t,a)=>(p(),u("li",{key:t.id},[$(k,{ref:o=>h.value[a]=o,article:t,index:a,onThumbsUp:o=>b(t,a),onRemoveThumbsUp:o=>C(t,a),onSubmitComment:j,onDeleteArticle:o=>A(t.id),onDeleteComment:w},null,8,["article","index","onThumbsUp","onRemoveThumbsUp","onDeleteArticle"])]))),128))]))}});export{V as default};
