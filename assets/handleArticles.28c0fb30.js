import{o as O,p as S,q as I,r as k,t as x,s as T}from"./index.f488c0b0.js";import{r as f,b as U}from"./vendor.d65808b7.js";const{state:A}=T;var P=v=>{const l=f([]),p=async t=>{try{const{data:e}=await v(t),{articles:s}=e;h(s)}catch(e){console.dir(e)}},u=(t,e)=>l.value[t]=e,b=async(t,e)=>{const s=JSON.parse(JSON.stringify(t)),{id:c}=s,{name:a,photo:o,job:r}=A.value.user,d={name:a,photo:o,job:r};try{const{data:n}=await O(d,c),{likes:i}=n;s.likes=i,u(e,s)}catch(n){console.log(n)}},w=async(t,e)=>{const s=JSON.parse(JSON.stringify(t));try{const{data:c}=await S(t.id),{likes:a}=c;s.likes=a,u(e,s)}catch(c){console.log(c)}},h=t=>l.value=t,g=async t=>{try{await I(t),p()}catch(e){console.dir(e)}},y=(t,e)=>l.value[t].comments=e,m=f(!1),C=t=>{const{articleId:e,articleIdx:s,comment:c}=t;if(m.value){alert("Please wait 30 seconds for each message");return}if(m.value=!0,!c){alert("comment required");return}const{name:a,photo:o}=A.value.user,r={name:a,photo:o||"",comment:c};return new Promise(async(d,n)=>{try{const{data:i}=await k(r,e),{comments:N}=i;y(s,N),d()}catch(i){n(i)}setTimeout(()=>{m.value=!1},30*1e3)})},J=async t=>{const{article:e,articleIdx:s,commentId:c}=t,a=JSON.parse(JSON.stringify(e));try{const{data:o}=await x(e.id,c),{comments:r}=o;a.comments=r,y(s,r)}catch(o){console.dir(o)}};return{articles:U(l),getArticles:p,setArticles:h,thumbsUpArticle:b,removeThumbsUpArticle:w,deleteArticle:g,postComment:C,deleteComment:J}};export{P as h};
