import{o as k,p as x,q as F,r as P,t as T,u as U,v as j,s as D}from"./index.f9042d71.js";import{r as f,b as q}from"./vendor.d65808b7.js";const{state:h}=D;var z=w=>{const n=f([]),p=async t=>{try{const{data:e}=await w(t),{articles:s}=e;v(s)}catch(e){console.dir(e)}},u=(t,e)=>n.value[t]=e,g=async(t,e)=>{const s=JSON.parse(JSON.stringify(t)),{id:a}=s,{name:c,photo:r,job:o}=h.value.user,d={name:c,photo:r,job:o};try{const{data:i}=await k(d,a),{likes:l}=i;s.likes=l,u(e,s)}catch(i){console.log(i)}},J=async(t,e)=>{const s=JSON.parse(JSON.stringify(t));try{const{data:a}=await x(t.id),{likes:c}=a;s.likes=c,u(e,s)}catch(a){console.log(a)}},v=t=>n.value=t,y=(t,e)=>n.value[t]=e,N=async t=>{try{await F(t),p()}catch(e){console.dir(e)}},A=(t,e)=>n.value[t].comments=e,m=f(!1),O=t=>{const{articleId:e,articleIdx:s,comment:a}=t;if(m.value){alert("Please wait 30 seconds for each message");return}if(m.value=!0,!a){alert("comment required");return}const{name:c,photo:r}=h.value.user,o={name:c,photo:r||"",comment:a};return new Promise(async(d,i)=>{try{const{data:l}=await P(o,e),{comments:I}=l;A(s,I),d()}catch(l){i(l)}setTimeout(()=>{m.value=!1},30*1e3)})},S=async t=>{const{article:e,articleIdx:s,commentId:a}=t,c=JSON.parse(JSON.stringify(e));try{const{data:r}=await T(e.id,a),{comments:o}=r;c.comments=o,A(s,o)}catch(r){console.dir(r)}},b=async(t,e)=>{const s=JSON.parse(JSON.stringify(t));try{const{data:a}=await U(t.id),{favorites:c}=a;s.favorites=c,y(e,s),alert("add success")}catch(a){console.log(a)}},C=async(t,e)=>{const s=JSON.parse(JSON.stringify(t));return new Promise(async(a,c)=>{try{const{data:r}=await j(t.id),{favorites:o}=r;s.favorites=o,y(e,s),alert("remove success"),a(o)}catch(r){c(r)}})};return{articles:q(n),getArticles:p,setArticles:v,thumbsUpArticle:g,removeThumbsUpArticle:J,deleteArticle:N,postComment:O,deleteComment:S,addArticleFavorite:b,removeArticleFavorite:C}};export{z as h};
