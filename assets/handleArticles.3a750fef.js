import{o as k,p as x,q as F,r as T,t as U,u as j,v as D,s as P}from"./index.49537e10.js";import{r as f,b as q}from"./vendor.d65808b7.js";const{state:h}=P;var z=g=>{const n=f([]),p=async t=>{try{const{data:e}=await g(t),{articles:s}=e;v(s)}catch(e){console.dir(e)}},u=(t,e)=>n.value[t]=e,w=async(t,e)=>{const s=JSON.parse(JSON.stringify(t)),{id:a}=s,{name:c,photo:o,job:r}=h.value.user,d={name:c,photo:o,job:r};try{const{data:i}=await k(d,a),{likes:l}=i;s.likes=l,u(e,s)}catch(i){console.log(i)}},J=async(t,e)=>{const s=JSON.parse(JSON.stringify(t));try{const{data:a}=await x(t.id),{likes:c}=a;s.likes=c,u(e,s)}catch(a){console.log(a)}},v=t=>n.value=t,y=(t,e)=>n.value[t]=e,N=async t=>{try{await F(t),p()}catch(e){console.dir(e)}},A=(t,e)=>n.value[t].comments=e,m=f(!1),O=t=>{const{articleId:e,articleIdx:s,comment:a}=t;if(m.value){alert("Please wait 30 seconds for each message");return}if(m.value=!0,!a){alert("comment required");return}const{name:c,photo:o}=h.value.user,r={name:c,photo:o||"",comment:a};return new Promise(async(d,i)=>{try{const{data:l}=await T(r,e),{comments:I}=l;A(s,I),d()}catch(l){i(l)}setTimeout(()=>{m.value=!1},30*1e3)})},S=async t=>{const{article:e,articleIdx:s,commentId:a}=t,c=JSON.parse(JSON.stringify(e));try{const{data:o}=await U(e.id,a),{comments:r}=o;c.comments=r,A(s,r)}catch(o){console.dir(o)}},b=async(t,e)=>{const s=JSON.parse(JSON.stringify(t));try{const{data:a}=await j(t.id),{favorites:c}=a;s.favorites=c,y(e,s),alert("add success")}catch(a){console.log(a)}},C=async(t,e)=>{const s=JSON.parse(JSON.stringify(t));try{const{data:a}=await D(t.id),{favorites:c}=a;s.favorites=c,y(e,s),alert("remove success")}catch(a){console.dir(a)}};return{articles:q(n),getArticles:p,setArticles:v,thumbsUpArticle:w,removeThumbsUpArticle:J,deleteArticle:N,postComment:O,deleteComment:S,addArticleFavorite:b,removeArticleFavorite:C}};export{z as h};
