import k from"./Article.7bbbbcfc.js";import{e as O,n as S,o as T,p as U,q as D,r as N,t as g}from"./index.fe1cc65e.js";import{d as J,j as _,k as I,r as l,c as u,F as x,m as R,o as p,i as $}from"./vendor.4dab4da4.js";import"./main.6def93c2.js";import"./dayjs.bfbae3ba.js";const V=J({setup(q){const h=_(O),c=I(()=>h.value.user),r=l([]),d=async()=>{try{const{data:e}=await S();r.value=e.articles}catch(e){console.dir(e)}},v=(e,s)=>r.value[e]=s,y=async e=>{try{await T(e),d()}catch(s){console.dir(s)}},A=async(e,s)=>{const t=JSON.parse(JSON.stringify(e)),a={name:c.value.name,photo:c.value.photo,job:c.value.job};try{const{data:o}=await U(a,e.id),{likes:n}=o.article;t.likes=n,v(s,t)}catch(o){console.dir(o)}},C=async(e,s)=>{const t=JSON.parse(JSON.stringify(e));try{const{data:a}=await D(e.id),{likes:o}=a.article;t.likes=o,v(s,t)}catch(a){console.dir(a)}},b=(e,s)=>r.value[e].comments=s,f=l([]),m=l(!1),j=async e=>{const{articleId:s,articleIdx:t,comment:a}=e;if(m.value){alert("Please wait 30 seconds for each message");return}if(m.value=!0,!a){alert("comment required");return}const o={name:c.value.name,photo:c.value.photo||"",comment:a};try{const{data:n}=await N(o,s),{comments:i}=n;b(t,i),f.value[t].resetCommentInput(t)}catch(n){console.dir(n)}setTimeout(()=>{m.value=!1},30*1e3)},w=async e=>{const{article:s,articleIdx:t,commentId:a}=e,o=JSON.parse(JSON.stringify(s));try{const{data:n}=await g(s.id,a),{comments:i}=n;o.comments=i,b(t,i)}catch(n){console.dir(n)}};return(()=>{d()})(),(e,s)=>(p(),u("ul",null,[(p(!0),u(x,null,R(r.value,(t,a)=>(p(),u("li",{key:t.id},[$(k,{ref:o=>f.value[a]=o,article:t,index:a,onThumbsUp:o=>A(t,a),onRemoveThumbsUp:o=>C(t,a),onSubmitComment:j,onDeleteArticle:o=>y(t.id),onDeleteComment:w},null,8,["article","index","onThumbsUp","onRemoveThumbsUp","onDeleteArticle"])]))),128))]))}});export{V as default};
